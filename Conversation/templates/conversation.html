{% extends "basepage.html" %}
{% block title %}Conversation {{ conversation.id }}{% endblock %}
{% block content %}
    {% load staticfiles %}
    <link rel="stylesheet" href="{% static "conversation.css" %}" />
    <div class="panel panel-white post panel-shadow">
        <div class="sentiment
            {% if root_tweet.sentiment < 0 %}
                sentiment-negative
            {% elif root_tweet.sentiment > 0 %}
                sentiment-positive
            {% else %}
                sentiment-neutral
            {% endif%}">
            <div class="post-heading">
                <div class="pull-left image">
                    <img src="{{ root_tweet.profile_image_url }}" class="img-circle avatar" alt="user profile image">
                </div>
                <div class="pull-left meta">
                    <div class="title h5">
                        <a href="#"><b>{{ root_tweet.display_name }}</b></a>
                        @{{ root_tweet.username }}
                    </div>
                    <h6 class="text-muted time">Importado el: {{ root_tweet.created_at }}</h6>
                </div>
            </div>
            <div class="post-description">
                <p>{{ root_tweet.text }}</p>
                <div class="stats">
                    <button type="button" class="btn btn-default stat-item">
                        <span class="glyphicon glyphicon-retweet" aria-hidden="true"></span>
                        {{ root_tweet.retweet_count }}
                    </button>
                    <button type="button" class="btn btn-default stat-item">
                        <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
                        {{ root_tweet.favourites_count }}
                    </button>
                </div>
            </div>
        </div>
        <div class="post-footer">
            {% if replies %}
                <ul class="comments-list">
                    {% for comment in replies %} {# tweet, new_ul|close_li, close_n_ul_li #}
                        <li class="comment">
                            <div class="sentiment
                                {% if comment.0.sentiment < 0 %}
                                    sentiment-negative
                                {% elif comment.0.sentiment > 0 %}
                                    sentiment-positive
                                {% else %}
                                    sentiment-neutral
                                {% endif%}">
                                <a class="pull-left" href="#">
                                    <img class="avatar" src="{{ comment.0.profile_image_url }}" alt="avatar">
                                </a>
                                <div class="comment-body">
                                    <div class="comment-heading">
                                        <h4 class="user"><a href="/conversation/{{ comment.0.id }}/show"><b>{{ comment.0.display_name }}</b></a>
                                            @{{ comment.0.username }}</h4>
                                        {# <h5 class="time">{{ comment.0.created_at }}</h5> #}
                                    </div>
                                    <p>{{ comment.0.text }}</p>
                                    <form action="/conversation/{{ comment.0.id }}/sentiment/edit" method="post" class="form">
                                        {% csrf_token %}
                                        <input type="hidden" name="conversation_id" value="{{ root_tweet.id }}"/>
                                        <div class="row">
                                            <div class="col-xs-2">
                                                <select name="sentiment" class="form-control input-sm">
                                                    <option value="negative" {% if comment.0.sentiment < 0 %} selected {% endif %}>En contra</option>
                                                    <option value="neutral" {% if comment.0.sentiment == 0 %} selected {% endif %}>Neutral</option>
                                                    <option value="positive" {% if comment.0.sentiment > 0 %} selected {% endif %}>A favor</option>
                                                </select>
                                            </div>
                                            <div class="col-xs-2">
                                                <button type="submit" class="btn btn-primary btn-sm">Guardar</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        {% if comment.1 == 1 %}
                            <ul class="comments-list">
                        {% else %}
                            </li>
                        {% endif %}
                        {% for i in comment.2 %}
                            </ul>
                            </li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            {% else %}
                <p>This conversation has no replies!</p>
            {% endif %}
        </div>
    </div>
{% endblock %}